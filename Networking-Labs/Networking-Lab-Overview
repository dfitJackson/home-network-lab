[‚¨Ö Back to Home](../README.md) ‚Ä¢ [‚û° VLAN Lab](vlan-segmentation-lab.md)

# üì° Networking & VLAN Segmentation Lab

This lab documents how I segmented my home network into **Home**, **Work**, and **IoT** networks using VLANs, a TP-Link ER605 router, an EdgeSwitch 150W core switch, an EdgeSwitch 8XP for IoT, and a BE550 access point.

---

## üéØ Objectives

- Create VLANs for:
  - **VLAN 1 ‚Äì Home**
  - **VLAN 20 ‚Äì Work**
  - **VLAN 30 ‚Äì IoT**
- Map switch ports on the **EdgeSwitch 150W** to the correct VLANs.
- Use the **ER605** for inter-VLAN routing and firewall rules.
- Use the **BE550** in AP mode for Home Wi-Fi only.
- Hang IoT devices off the **EdgeSwitch 8XP** on VLAN 30.
- Validate segmentation using Windows and Ubuntu clients.

---

## üõ† Hardware Used

- TP-Link **ER605** ‚Äì router / gateway
- Ubiquiti **EdgeSwitch 8-Port 150W** ‚Äì core switch
- Ubiquiti **EdgeSwitch 8XP** ‚Äì IoT / PoE switch
- TP-Link **BE550** (Wi-Fi 7) ‚Äì access point in AP mode
- **Pi-hole** ‚Äì DNS filtering during testing
- Windows 10, Windows 11, and Ubuntu devices

---

## üåê Network Topology (YAML)
```yaml
network_topology:
  diagram: |
    ISP Modem
        ‚Üì
    ER605 Router (Omada)
        ‚îú‚îÄ‚îÄ TP-Link BE550 (AP Mode ‚Äì Home Wi-Fi, VLAN 1)
        ‚îî‚îÄ‚îÄ EdgeSwitch 150W (Core Switch)
              ‚îú‚îÄ‚îÄ Personal PC (VLAN 1 ‚Äì Home LAN)
              ‚îú‚îÄ‚îÄ Work Laptop Dock (VLAN 20 ‚Äì Work)
              ‚îî‚îÄ‚îÄ EdgeSwitch 8XP (IoT Switch ‚Äì VLAN 30)
                    ‚îú‚îÄ‚îÄ Smart Plugs (VLAN 30)
                    ‚îú‚îÄ‚îÄ Cameras (VLAN 30)
                    ‚îî‚îÄ‚îÄ Other IoT Devices (VLAN 30)

```

---

## üîß VLAN Configuration (EdgeSwitch 150W)

### VLAN IDs

- **VLAN 1** ‚Üí Home  
- **VLAN 20** ‚Üí Work  
- **VLAN 30** ‚Üí IoT  

### Port Assignments

| Port | Purpose                                | VLAN Mode       |
|------|----------------------------------------|-----------------|
| 1    | ER605 Router ‚Üí Switch                  | Untagged VLAN 1 |
| 2    | Work Laptop (Dock)                     | Untagged VLAN 20|
| 3‚Äì4  | Free / Future Expansion                | Excluded        |
| 5    | Uplink to EdgeSwitch 8XP (IoT switch)  | Untagged VLAN 1 |
| 6    | Personal PC                            | Untagged VLAN 1 |
| 7‚Äì8  | BE550 AP or future devices             | Depends on use  |

> No tagged ports required at this stage because wireless gear wasn‚Äôt yet carrying multiple VLANs via 802.1Q tags.

---

## üåê Router (ER605) ‚Äì VLAN Interfaces & Firewall

**Subnets**

- **VLAN 1 ‚Äì Home:** `192.168.1.0/24`
- **VLAN 20 ‚Äì Work:** `192.168.20.0/24`
- **VLAN 30 ‚Äì IoT:** `192.168.30.0/24`

**Firewall behaviour (high-level)**

- Work ‚Üí Home: **Blocked**
- IoT ‚Üí Home: **Blocked**
- IoT ‚Üí Work: **Blocked**
- Home ‚Üí Work: **Optionally allowed** (for management)
- All VLANs ‚Üí Internet: **Allowed**

---

## üß™ Validation & Testing

**IP Assignment**

- Work device received an address in `192.168.20.x`.
- Home device received an address in `192.168.1.x`.
- IoT devices received addresses in `192.168.30.x`.

**Segmentation Tests**

- Work VLAN **could not** reach Home devices.
- IoT VLAN was isolated from both Home and Work.
- Home VLAN could reach Work when the firewall rule was enabled.
- When clients used Pi-hole as DNS, ad / tracking domains were blocked as expected.

**Wi-Fi Verification**

- BE550 configured in **AP mode** only.
- BE550 SSID mapped to **VLAN 1 (Home)**.

---

## ‚ö†Ô∏è Issues Encountered & Fixes

### 1. Lost Internet When Changing DHCP DNS
**Issue:** Setting Pi-hole as DNS caused devices to lose internet.  
**Cause:** Pi-hole VLAN routing wasn‚Äôt configured yet.  
**Fix:** Updated ER605 DHCP options + ensured Pi-hole reachable on VLAN 1.  
**Result:** Devices regained internet and used Pi-hole for DNS filtering.

---

### 2. BE550 Kept Reverting to Router Mode
**Issue:** BE550 wouldn‚Äôt stay in AP Mode and restarted setup repeatedly.  
**Cause:** Previous mesh settings + firmware auto-detection.  
**Fix:** Full factory reset ‚Üí Configure from scratch ‚Üí AP Mode only.  
**Result:** Stable Wi-Fi 7 access point running on VLAN 1.

---

### 3. Incorrect VLAN Assignments on the EdgeSwitch 150W
**Issue:** Ports occasionally mapped to the wrong VLAN (excluded/untagged mix-ups).  
**Cause:** UI terminology differences between Ubiquiti and standard VLAN naming.  
**Fix:** Rebuilt VLAN table using only Untagged/Excluded (no 802.1Q tagging).  
**Result:** Stable segmentation between Home, Work, and IoT VLANs.

---

### 4. IoT Network Not Receiving DHCP
**Issue:** IoT devices received no IP addresses via the 8XP.  
**Cause:** ER605 VLAN 30 interface missing after changes.  
**Fix:** Reboot 8XP ‚Üí Refresh DHCP leases ‚Üí Recreate VLAN interface on ER605.  
**Result:** IoT devices receiving proper DHCP on 192.168.30.x.

---

### 5. ER605 Controller Sync Problems
**Issue:** ER605 would not apply new configuration from the controller.  
**Cause:** Controller mismatched state + corrupted previous adoption attempt.  
**Fix:** Multiple factory resets, re-adopt, then apply config cleanly.  
**Result:** Controller now pushes VLAN, DHCP, and firewall rules reliably.

---

### 6. Home VLAN Lost Internet During Testing
**Issue:** Internet dropped when switching WAN DNS & Pi-hole routing.  
**Cause:** Pi-hole was unreachable until routes were rebuilt.  
**Fix:** Updated DNS settings ‚Üí Confirmed Pi-hole static IP ‚Üí Tested VLAN paths.  
**Result:** Stable Home network with working Pi-hole DNS filtering.

---

### 7. Old VLAN Folder Was Duplicate / Broken
**Issue:** Old GitHub VLAN folder duplicated README content and caused confusion.  
**Fix:** Deleted the old folder ‚Üí Replaced with new clean YAML-structured write-up.  
**Result:** Clean, professional documentation with proper formatting.

---

## üìÑ Summary

This lab demonstrates:

- Practical VLAN segmentation in a home environment  
- Port-based VLAN configuration on the **EdgeSwitch 150W**  
- Using the **ER605** for VLAN interfaces and basic firewalling  
- Isolating **IoT** devices on a separate switch and VLAN  
- Documenting a home lab in a way that‚Äôs readable for recruiters and technical reviewers

[‚¨Ö Back to Home](README.md)
